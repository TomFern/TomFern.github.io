{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/sar-guide","result":{"data":{"markdownRemark":{"id":"f2379c42-f15f-51ad-8d9b-ce69bf20e10d","html":"<p>sar is part of the <a href=\"http://pagesperso-orange.fr/sebastien.godard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sysstat</a> project, a suite of programs for system monitoring.\nWith sar, we can log system activity, build performance reports and even make plots.</p>\n<p>sar is available on Linux, Solaris, AIX and HP-UX.</p>\n<p>We can choose to run sar automatically, as an unattended script. Or interactively and get system metrics on the spot.</p>\n<h2 id=\"unattended-mode\" style=\"position:relative;\"><a href=\"#unattended-mode\" aria-label=\"unattended mode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Unattended Mode</h2>\n<p>With a simple cron entry we can log system activity. If possible, as root, otherwise some data may be missing.</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># cron entries, take a sample every 10 minutes\n@reboot /usr/lib/sa/sa1 --boot\n*/10 * * * * /usr/lib/sa/sa1 1 1 -S DISK</code></pre></div>\n<p>The <code class=\"language-text\">@reboot</code> line is kind of optional, but if the cron supports it’s good to have since it ensures the counters are reset\non boot.</p>\n<p><code class=\"language-text\">sa1</code> is script that calls <code class=\"language-text\">sadc</code>, which does the actual collection.\nTo prevent the files from growing too large not everything is stored, however\nadditional counters can be enabled with <code class=\"language-text\">-S</code>.</p>\n<p>Optional collection options for sadc:</p>\n<ul>\n<li>DISK block devices</li>\n<li>XDISK block devices and partitions</li>\n<li>INT system interrupts</li>\n<li>IPV6 network IPV6 statistics</li>\n<li>POWER power management</li>\n<li>SNMP is for the SNMP statistics</li>\n<li>ALL everything except XDISK</li>\n<li>XALL everthing including XDISK</li>\n</ul>\n<blockquote>\n<p>Also check sysstat’s config for compression and retention options. /etc/conf.d/sysstat or /etc/default/sysstat</p>\n</blockquote>\n<p>To access the stored data we have two alternatives:</p>\n<p><code class=\"language-text\">sa2</code> is a script that generates an activity report for the previous day (/var/log/sarNN). This can be croned easily:</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># generate daily activity report\n00 18 * * * /usr/lib/sa/sa2 -A</code></pre></div>\n<p>The other way is calling <code class=\"language-text\">sar</code> directly, this lets us choose the view:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># sar views with extended options\n-u [ALL]  CPU utilization (default view)\n-b        I/O rates\n-d        block device activity\n-F        mounted filesystem statistics\n-n ALL    network statistics\n-P ALL    per processor statistics\n-q        queue and load average\n-r [ALL]  memory utilization\n-H        hugepages utilization\n-S        swap space utilization\n-B        paging statistics\n-W        swapping activity\n-v        inode and kernel tables\n-w        task/process creation\n-y        TTY device activity\n-m ALL    power management statistics\n-I ALL    interrupts\n-A        Everything</code></pre></div>\n<p>Some views have additional options, for example <code class=\"language-text\">-n ALL</code> shows all network activity (including protocols) while <code class=\"language-text\">-n DEV</code>\nonly shows network devices.</p>\n<p>sar by default shows today’s logs, <code class=\"language-text\">-1</code> brings yesterday’s, <code class=\"language-text\">-2</code> the day before yesterday and so on.\nWe can specify the day’s starting <code class=\"language-text\">-s</code> and end times <code class=\"language-text\">-e</code> in HH:MM:SS format</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># yesterday&#39;s cpu report, with start and end time\nsar -1 -s 2:58:05 -e 2:58:55\nLinux 4.19.8-arch1-1-ARCH (ix) \t12/26/2018 \t_x86_64_\t(4 CPU)\n\n02:58:05 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n02:58:10 PM     all     10.89      0.00      7.82      0.00      0.00     81.29\n02:58:15 PM     all      9.82      0.00      7.35      0.00      0.00     82.83\n02:58:20 PM     all     11.28      0.00      6.33      0.05      0.00     82.34\n02:58:25 PM     all     10.69      0.00      7.06      0.05      0.00     82.21\n02:58:30 PM     all     10.27      0.00      7.02      0.00      0.00     82.71\n02:58:35 PM     all     11.49      0.00      8.22      0.00      0.00     80.30\n02:58:40 PM     all     11.90      0.00      6.66      0.05      0.00     81.39\n02:58:45 PM     all     14.38      0.00      7.14      0.05      0.00     78.43\n02:58:50 PM     all     10.66      0.00      6.63      0.00      0.00     82.71\n02:58:55 PM     all     15.01      0.00      6.63      0.00      0.00     78.35\nAverage:        all     11.63      0.00      7.09      0.02      0.00     81.26</code></pre></div>\n<h2 id=\"interactive-sar\" style=\"position:relative;\"><a href=\"#interactive-sar\" aria-label=\"interactive sar permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Interactive Sar</h2>\n<p>A quicker alternative is running sar interactively. We can log system activity while doing some other tasks.\nPerhaps while running a benchmark or doing some troubleshooting.</p>\n<p>With the <code class=\"language-text\">-o</code> option, sar stores/appends data in a file or directory.</p>\n<p>sar takes a sample <em>interval</em> (in seconds) and <em>count</em> that works as a stop condition.</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># collect activity in my_metrics file, 1 sample per second, 60 samples total\nsar -o my_metrics 1 60\nLinux 4.19.8-arch1-1-ARCH (ix) \t12/24/2018 \t_x86_64_\t(4 CPU)\n\n07:01:06 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n07:01:07 PM     all     11.08      0.00      4.79      0.00      0.00     84.13\n07:01:08 PM     all     13.71      0.00      7.11      0.25      0.00     78.93\n07:01:09 PM     all     13.62      0.00      6.43      0.00      0.00     79.95\n07:01:10 PM     all     13.99      0.00      6.36      0.00      0.00     79.64\n...</code></pre></div>\n<p>If you’ve used <a href=\"./vmstat-guide\">mpstat</a> before, you’ll recognize the format, it’s exactly the same.</p>\n<p>To retrieve the results we use <code class=\"language-text\">-f</code>.\nWe can use a different <em>interval</em> or <em>count</em> and the output will be filtered appropiately.</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># print report from my_metrics file\nsar -f my_metrics -s 14:00:00 1 5\nLinux 4.19.8-arch1-1-ARCH (ix) \t12/24/2018 \t_x86_64_\t(4 CPU)\n\n14:00:00 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n14:00:01 PM     all      9.47      0.00      6.01      0.00      0.00     84.52\n14:00:02 PM     all     11.11      0.00      5.05      0.00      0.00     83.84\n14:00:03 PM     all     29.62      0.00      9.87      0.00      0.00     60.51\n14:00:04 PM     all     12.85      0.00      3.27      0.00      0.00     83.88\n14:00:05 PM     all     20.00      0.00      8.86      0.00      0.00     71.14\nAverage:        all     16.09      0.00      6.57      0.00      0.00     77.35</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># print memory activity from my_metrics file\nsar -r -f my_metrics\nLinux 4.19.8-arch1-1-ARCH (ix) \t12/24/2018 \t_x86_64_\t(4 CPU)\n\n07:45:47 PM kbmemfree   kbavail kbmemused  %memused kbbuffers  kbcached  kbcommit   %commit  kbactive   kbinact   kbdirty\n07:45:48 PM    755544   5216144   5525576     47.27    876804   3773928  14648100     83.48   7714540   2267792      4404\n07:45:49 PM    753728   5214328   5527772     47.29    876804   3773548  14648100     83.48   7716816   2267400      4420\n07:45:50 PM    734512   5195136   5546088     47.45    876804   3774448  14651412     83.49   7734560   2268308      4432\n07:45:51 PM    717524   5178164   5562876     47.59    876804   3774648  14670976     83.61   7750836   2268504      4448\n07:45:52 PM    711580   5172232   5568900     47.65    876804   3774568  14670976     83.61   7757748   2268428      4460\nAverage:       734578   5195201   5546242     47.45    876804   3774228  14657913     83.53   7734900   2268086      4433</code></pre></div>\n<h2 id=\"exporting-sars-data\" style=\"position:relative;\"><a href=\"#exporting-sars-data\" aria-label=\"exporting sars data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Exporting Sar’s Data</h2>\n<p>Wouldn’t it be great to be able to export the collected data? Maybe to a database or a spreasheet?\nDon’t we deserve some nice plots? No worries, <code class=\"language-text\">sadf</code> has us covered.</p>\n<p>sadf syntax is a bit quirkier:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sadf [options] [ &lt;interval&gt; [ &lt;count&gt; ] ] [ &lt;datafile&gt; | -[0-9]+ ] -- [sar options]\n\n  options:\n    -p table\n    -d CSV\n    -r raw CSV (as read from the kernel)\n    -x XML\n    -d JSON\n    -g SVG</code></pre></div>\n<p>The options to the right of the <code class=\"language-text\">--</code> are sent to sar for printing the report, here we can choose what views to export.</p>\n<p>To select the log file we can use either <code class=\"language-text\">0</code>, <code class=\"language-text\">-1</code>, etc for daily logs (as in the unattended mode) or just\nprovide the path to the datafile.</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># export yesterday&#39;s I/O activity in CSV\nsadf -d -1  -- -b\n# hostname;interval;timestamp;tps;rtps;wtps;bread/s;bwrtn/s\nix;1;2018-12-26 17:58:06 UTC;20.00;0.00;20.00;0.00;168.00\nix;1;2018-12-26 17:58:07 UTC;0.00;0.00;0.00;0.00;0.00\nix;1;2018-12-26 17:58:08 UTC;0.00;0.00;0.00;0.00;0.00\nix;1;2018-12-26 17:58:09 UTC;71.00;0.00;71.00;0.00;624.00\n...</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># export CPU activity from my_metrics file in JSON\nsadf -j my_metrics -- -u\n{&quot;sysstat&quot;: {\n        &quot;hosts&quot;: [\n                {\n                        &quot;nodename&quot;: &quot;ix&quot;,\n                        &quot;sysname&quot;: &quot;Linux&quot;,\n                        &quot;release&quot;: &quot;4.19.8-arch1-1-ARCH&quot;,\n                        &quot;machine&quot;: &quot;x86_64&quot;,\n                        &quot;number-of-cpus&quot;: 4,\n                        &quot;file-date&quot;: &quot;2018-12-26&quot;,\n                        &quot;file-utc-time&quot;: &quot;17:58:05&quot;,\n                        &quot;statistics&quot;: [\n                                {\n                                        &quot;timestamp&quot;: {&quot;date&quot;: &quot;2018-12-26&quot;, &quot;time&quot;: &quot;17:58:06&quot;, &quot;utc&quot;: 1, &quot;interval&quot;: 1},\n                                        &quot;cpu-load&quot;: [\n                                                {&quot;cpu&quot;: &quot;all&quot;, &quot;user&quot;: 16.11, &quot;nice&quot;: 0.00, &quot;system&quot;: 10.58, &quot;iowait&quot;: 0.00, &quot;steal&quot;: 0.00, &quot;idle&quot;: 73.32}\n                                        ]\n                                },\n...</code></pre></div>\n<p>With <code class=\"language-text\">-g</code> we get SVG output that we can redirect into a file.</p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># export CPU activity as SVG plot\nsadf -g -- -u &gt; cpu.svg</code></pre></div>\n<p><img src=\"/media/img/sadf-cpu-example.png\" alt=\"CPU Utilization\"></p>\n<div class=\"gatsby-highlight\" data-language=\"nil\"><pre class=\"language-nil\"><code class=\"language-nil\"># export network activity for device eth0 as SVG plot\nsadf -g  -- -n DEV --iface=eth0 &gt; a.svg</code></pre></div>\n<p><img src=\"/media/img/sadf-network-example.png\" alt=\"Network Usage\"></p>\n<h2 id=\"related-links\" style=\"position:relative;\"><a href=\"#related-links\" aria-label=\"related links permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Related Links</h2>\n<ul>\n<li>sysstat website: <a href=\"http://pagesperso-orange.fr/sebastien.godard\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://pagesperso-orange.fr/sebastien.godard</a></li>\n<li>sysstat github: <a href=\"https://github.com/sysstat/sysstat\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/sysstat/sysstat</a></li>\n<li>\n<p>manpages</p>\n<ul>\n<li>sar: <a href=\"https://linux.die.net/man/1/sar\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://linux.die.net/man/1/sar</a></li>\n<li>sa1: <a href=\"https://linux.die.net/man/8/sa1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://linux.die.net/man/8/sa1</a></li>\n<li>sa2: <a href=\"https://linux.die.net/man/8/sa2\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://linux.die.net/man/8/sa2</a></li>\n<li>sadc: <a href=\"https://linux.die.net/man/8/sadc\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://linux.die.net/man/8/sadc</a></li>\n<li>sadf: <a href=\"https://linux.die.net/man/1/sadf\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://linux.die.net/man/1/sadf</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"wrapping-up\" style=\"position:relative;\"><a href=\"#wrapping-up\" aria-label=\"wrapping up permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Wrapping Up</h2>\n<p>For sure, there are a lot of more options available, I just can’t cover them all, but I think the basics were covered.</p>\n<p>That’s all for now. If interested on system monitoring, sure to check my previous article about <a href=\"./vmstat-guide\">vmstat</a>.</p>\n<p>Have a good one.</p>\n<p>Tomas</p>","fields":{"slug":"/posts/sar-guide","tagSlugs":["/tag/guides/","/tag/monitoring/","/tag/linux/","/tag/unix/"]},"frontmatter":{"date":"2019-01-07T01:40:00-03:00","description":"A guide to system monitoring with sar","tags":["guides","monitoring","linux","unix"],"title":"System Monitoring with Sar","socialImage":"/social/linux.jpg"}}},"pageContext":{"slug":"/posts/sar-guide"}},"staticQueryHashes":["251939775","2946977831","401334301"]}