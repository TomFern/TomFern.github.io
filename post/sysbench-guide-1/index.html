<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Benchmarking with sysbench - tomfern.com</title>
  <meta name="description" content="A getting started guide to benchmarking with sysbench">
  <meta name="author" content="Tom"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "tomfern.com",
    
    "url": "https:\/\/tomfern.com"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/tomfern.com"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/tomfern.com",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/tomfern.com\/post\/sysbench-guide-1\/",
          "name": "Benchmarking with sysbench"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Tom"
  },
  "headline": "Benchmarking with sysbench",
  "description" : "A getting started guide to benchmarking with sysbench\n",
  "inLanguage" : "en",
  "wordCount":  2080 ,
  "datePublished" : "2019-01-09T00:05:00",
  "dateModified" : "2019-01-09T00:05:00",
  "image" : "https:\/\/tomfern.com",
  "keywords" : [ "linux, unix, guides" ],
  "mainEntityOfPage" : "https:\/\/tomfern.com\/post\/sysbench-guide-1\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/tomfern.com",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/tomfern.com",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="Benchmarking with sysbench" />
<meta property="og:description" content="A getting started guide to benchmarking with sysbench">
<meta property="og:url" content="https://tomfern.com/post/sysbench-guide-1/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="tomfern.com" />

  <meta name="twitter:title" content="Benchmarking with sysbench" />
  <meta name="twitter:description" content="A getting started guide to benchmarking with sysbench">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@TomFernBlog" />
  <meta name="twitter:creator" content="@TomFernBlog" />
  <link href='https://tomfern.com/favicon/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.61.0" />
  <link rel="alternate" href="https://tomfern.com/index.xml" type="application/rss+xml" title="tomfern.com"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://tomfern.com/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tomfern.com/css/highlight.min.css" /><link rel="stylesheet" href="https://tomfern.com/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<style>
 

div.alert {
  border-radius: 10px;
  margin-bottom: 1rem;
}

div.alert p {
  position: relative;
  display: block;
  font-size: 1rem;
  margin-left: 2rem;
  margin-top: 0;
  margin-bottom: 0;
}

div.alert p:first-child::before {
  position: absolute;
  top: -0.5rem;
  left: -2rem;
  font-family: 'FontAwesome';
  font-size: 1.5rem;
  color: #fff;
  content: '\f05a';
  width: 1.5rem;
  text-align: center;
}

div.alert-warning p:first-child::before {
  content: '\f071';
}

div.alert a {
  color: rgba(255,255,255,0.9);
  text-decoration: none;
  border-bottom: solid 1px #e4e4e4;
  transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
}

div.alert a:hover {
  border-bottom-color: transparent;
  color: rgba(255,255,255,0.5) !important;
}

.alert-note {
  color: #fff;
  background-color: #03A9F4;  
  border-color: #bce8f1;
}

.alert-warning {
  color: #fff;
  background-color: #f44336;  
  border-color: #ebccd1;
}

.toc {
    background-color: #F5F5F5;
}

.heading {
    font-weight: 800;
}

.tip-box
{
     background-color: #f0f7fb;
     background-repeat: no-repeat;
     border-left: solid 4px #3498db;
     overflow: hidden;
     padding: 1rem;
}


</style>



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tomfern.com">tomfern.com</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Benchmarking with sysbench</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on January 9, 2019
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;10&nbsp;minutes
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Tom
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>A getting started guide to benchmarking with sysbench</p>
<hr>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><a href="#why-when-how">Why, When, How?</a></li>
<li><a href="#introducing-sysbench">Introducing sysbench</a></li>
<li><a href="#getting-started">Getting started</a></li>
<li><a href="#the-test-loop">The test loop</a></li>
<li><a href="#testing-your-cpus">Testing your CPUs</a></li>
<li><a href="#testing-your-memory">Testing your memory</a></li>
<li><a href="#testing-your-disk-i-o-speed">Testing your disk I/O speed</a></li>
<li><a href="#testing-mutexes">Testing mutexes</a></li>
<li><a href="#testing-threads">Testing threads</a></li>
<li><a href="#related-links">Related links</a></li>
<li><a href="#what-s-next">What's next?</a></li>
</ul>
<!-- raw HTML omitted -->
<h2 id="why-when-how">Why, When, How?</h2>
<p>Benchmark shows the difference between should and does. Coupled with <a href="../../tags/monitoring">monitoring</a> it's a great tool to identify bottlenecks.</p>
<p>As to when: whenever we can, as long as the system is production. A good benchmark will stress the server so we don't want users affected.
Right after provisioning a server, during a maintenance window, before and after any major changes, these are all good opportunities to take advantage of a few precious
minutes of calm to run some tests.</p>
<p>We should try to mimic as best as possible the behaviour of the software we have.
Is it single or multithreaded? Is it on more CPU bound or disk IO bound. Does it access data randomly or sequentially?
Does it manage data on fixed-size blocks?</p>
<h2 id="introducing-sysbench">Introducing sysbench</h2>
<p>Sysbench is a popular benchmark tool that is available for linux, mac and can even run on windows (with it's subsystem for linux).
It ships with tests for the OS and databases. It is extensible and scriptable, so writing our own tests is possible.</p>
<p>If you are running linux, it's most likely available in your distribution repository. Otherwise head to sysbench's <a href="https://github.com/akopytov/sysbench">github</a> for instructions.</p>
<h2 id="getting-started">Getting started</h2>
<p>The general syntax is:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">sysbench &lt;testname&gt; &lt;action&gt; <span class="o">[</span>test-specific options<span class="o">]</span>
</code></pre></div><p>Sysbench has quite a few options, but help a few keystrokes away. To get to the general help:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">sysbench --help
</code></pre></div><p>And for the specific test use:</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">sysbench &lt;testname&gt; <span class="nb">help</span>
</code></pre></div><p>Some tests have a <em>prepare</em> and <em>cleanup</em> action, some also have an optional <em>warmup</em> action, others can be <em>run</em> directly.</p>
<h2 id="the-test-loop">The test loop</h2>
<p>All tests have a common structure, the requested number of worker threads are created, each one will run its own test loop,
each iteration of the loop is called an <em>event</em> and can have any number of operations. Sysbench keeps counters on all events across all threads.</p>
<p>When it's done, we get the statistics for all events. Under <em>latency</em> we can see the average event duration.
These values are common to all tests.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">...
General statistics:
    total time:                          10.0014s
    total number of events:              32479

Latency (ms):
         min:                                    1.11
         avg:                                    2.46
         max:                                   41.95
         95th percentile:                       11.24
         sum:                                79934.27

Threads fairness:
    events (avg/stddev):           4059.8750/59.44
    execution time (avg/stddev):   9.9918/0.01
</code></pre></div><p>On multithreaded tests we want that events are distributed fairly among all threads, i.e. all threads should execute approximately the same number of events.
This is shown under <em>fairness</em>, the <em>stddev</em> (standard deviation) should be small in relation to the <em>average</em>.</p>
<p>Most of the benchmarks will run for a specified time or until a certain condition is met. The default time limit is 10 seconds, but we can
change that using <code>--time</code>. Alternatively we can set a limit number of <code>--events</code>.</p>
<h2 id="testing-your-cpus">Testing your CPUs</h2>
<p>In this first test we'll torture the CPUs by computing prime numbers.
Each single event will check prime numbers up to the provided <code>--cpu-max-prime</code>.
The higher this value is, the longer it takes an event to end.</p>
<p>I usually like to start with single threadetest. I try to find a <code>--cpu-max-prime</code> that will take at least a few seconds to complete.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># sysbench cpu test, single event
-&gt; sysbench cpu run --threads=1 --events=1 --cpu-max-prime=8000000
sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Prime numbers limit: 8000000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:     0.09

General statistics:
    total time:                          11.2315s
    total number of events:              1

Latency (ms):
         min:                                11231.45
         avg:                                11231.45
         max:                                11231.45
         95th percentile:                    11317.84
         sum:                                11231.45

Threads fairness:
    events (avg/stddev):           1.0000/0.00
    execution time (avg/stddev):   11.2314/0.00
</code></pre></div><p>With a suitable max prime number found, the next step is to run a longer test.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># sysbench cpu, single thread
-&gt; sysbench cpu run --threads=1 --time=60 --cpu-max-prime=8000000
sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Prime numbers limit: 8000000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:     0.09

General statistics:
    total time:                          67.5691s
    total number of events:              6

Latency (ms):
         min:                                11217.78
         avg:                                11261.48
         max:                                11302.15
         95th percentile:                    11317.84
         sum:                                67568.87

Threads fairness:
    events (avg/stddev):           6.0000/0.00
    execution time (avg/stddev):   67.5689/0.00
</code></pre></div><p>On <em>average</em>, it took 11.261 seconds to calculate primes up to our limit.
A lower average is better, since it means the CPU takes less time to reach the same point. For the same reason, a higher value in <em>events per second</em> is better.</p>
<p>If we are going to run multithreaded applications we need to run another test with an appropiate number <code>--threads</code>.
For example in a system with 4 cores with hyperthreading this is a good starting point.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># cpu test, 8 threads
-&gt; sysbench cpu run --threads=8 --time=60 --cpu-max-prime=8000000
sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 8
Initializing random number generator from current time


Prime numbers limit: 8000000

Initializing worker threads...

Threads started!

CPU speed:
    events per second:     0.29

General statistics:
    total time:                          82.1154s
    total number of events:              24

Latency (ms):
         min:                                26514.20
         avg:                                27212.58
         max:                                28103.35
         95th percentile:                    27846.48
         sum:                               653101.88

Threads fairness:
    events (avg/stddev):           3.0000/0.00
    execution time (avg/stddev):   81.6377/0.36
</code></pre></div><h2 id="testing-your-memory">Testing your memory</h2>
<p>For memory we can test either <em>write</em> or <em>read</em> speeds, the mode is selected with <code>--memory-open</code>.
We can choose between sequential (<em>seq</em>) and random (<em>rnd</em>) access modes with <code>--memory-access-mode</code>.</p>
<p>This benchmark has a special stop condition: <code>--memory-total-size</code>. Bear in mind, this isn't the total size allocated in RAM.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># memory, no time limit, stop on 100GB written
-&gt; sysbench memory run --memory-total-size=100G --memory-open=write --memory-access-mode=rnd --time=0
WARNING: Both event and time limits are disabled, running an endless test
sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Running memory speed test with the following options:
  block size: 1KiB
  total size: 102400MiB
  operation: write
  scope: global

Initializing worker threads...

Threads started!

Total operations: 104857600 (5010197.95 per second)

102400.00 MiB transferred (4892.77 MiB/sec)


General statistics:
    total time:                          20.9272s
    total number of events:              104857600

Latency (ms):
         min:                                    0.00
         avg:                                    0.00
         max:                                    0.38
         95th percentile:                        0.00
         sum:                                10816.80

Threads fairness:
    events (avg/stddev):           104857600.0000/0.00
    execution time (avg/stddev):   10.8168/0.00
</code></pre></div><p>The latency is measured in milliseconds, it's just to big of a unit for memory speeds so it's not very useful here.
But we can think of the <em>MiB per seconds</em> as the average speed.</p>
<p>If we have a service that work with fixed-size blocks, for example if plan to have a database,
we should set <code>--memory-block-size</code> to match it.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># some memory tests for MySQL (page size is 16K)
sysbench memory run --threads=8 --memory-block-size=16K --memory-total-size=100G --memory-oper=write
sysbench memory run --threads=8 --memory-block-size=16K --memory-total-size=100G --memory-oper=read
</code></pre></div><h2 id="testing-your-disk-i-o-speed">Testing your disk I/O speed</h2>
<p>Before starting, we need to <em>prepare</em> a file or set of files to work on. We set the <strong>total</strong> space to allocate with <code>--file-total-size</code> (which must be at least 2GB)
and how many files there will be in the set, the space will be split into even sized files.</p>
<p>We probably want to avoid caching the files in memory because we wouldn't be measuring the true disk spee,
so it might me a good idea to include <code>--file-extra-flags=direct</code> to bypass it.</p>
<p>It's generally recommended, whenever possible, that allocated space is larger than the installed RAM, just in case caching is taking place in spite of our best efforts.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">-&gt; sysbench fileio prepare --file-num=10 --file-total-size=10G --file-extra-flags=direct

sysbench 1.0.15 (using system LuaJIT 2.0.5)

10 files, 1048576Kb each, 10240Mb total
Creating files for the test...
Extra file open flags: (none)
Creating file test_file.0
Creating file test_file.1
Creating file test_file.2
Creating file test_file.3
Creating file test_file.4
Creating file test_file.5
Creating file test_file.6
Creating file test_file.7
Creating file test_file.8
Creating file test_file.9
10737418240 bytes written in 45.15 seconds (226.78 MiB/sec).
</code></pre></div><!-- raw HTML omitted -->
<p><em>prepare</em> can reutilize previous test files, but it only can <strong>grow</strong> them, so we can only reuse test files if they are bigger or equal than before.
Otherwise we must <em>cleanup</em> and <em>prepare</em> again.</p>
<!-- raw HTML omitted -->
<p>Now we need to choose a <code>--file-test-mode</code>:</p>
<ul>
<li>seqwr: sequential write</li>
<li>seqrewr: sequential read+write</li>
<li>seqrd: sequential read</li>
<li>rndrd: random read</li>
<li>rndwr: random write</li>
<li>rndrw: random read write</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># file read-write test
-&gt; sysbench fileio run --file-num=10 --file-total-size=10G --file-test-mode=rndrw --file-extra-flags=direct --time=60

sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Extra file open flags: directio
10 files, 1GiB each
10GiB total file size
Block size 16KiB
Number of IO requests: 0
Read/Write ratio for combined random IO test: 1.50
Periodic FSYNC enabled, calling fsync() each 100 requests.
Calling fsync() at the end of test, Enabled.
Using synchronous I/O mode
Doing random r/w test
Initializing worker threads...

Threads started!


File operations:
    reads/s:                      2388.59
    writes/s:                     1592.38
    fsyncs/s:                     398.14

Throughput:
    read, MiB/s:                  37.32
    written, MiB/s:               24.88

General statistics:
    total time:                          60.0027s
    total number of events:              262756

Latency (ms):
         min:                                    0.06
         avg:                                    0.23
         max:                                   77.63
         95th percentile:                        0.39
         sum:                                59796.75

Threads fairness:
    events (avg/stddev):           262756.0000/0.00
    execution time (avg/stddev):   59.7967/0.00
</code></pre></div><p>As always, it's a good idea to try to match as best as possible the disk IO activity for our application. We have some flexibility here
with additional options:</p>
<ul>
<li><code>--file-num</code> number of files [128]</li>
<li><code>--file-block-size</code> block size [16384]</li>
<li><code>--file-total-size</code> total size  [2G]</li>
<li><code>--file-test-mode</code> test mode: seqwr, seqrewr, seqrd, rndrd, rndwr, rndrw</li>
<li><code>--file-io-mode</code> file operations mode: sync,async,mmap [sync]</li>
<li><code>--file-async-backlog</code> number of asynchronous requests per thread [128]</li>
<li><code>--file-extra-flags</code> list of additional flags to use to open files: sync,dsync,direct</li>
<li><code>--file-fsync-freq</code> fsync() every N requests [100]</li>
<li><code>--file-fsync-all</code> fsync() after each write [off]</li>
<li><code>--file-fsync-end</code> fsync() at the end of test [on]</li>
<li><code>--file-fsync-mode</code> method for sync: fsync, fdatasync [fsync]</li>
<li><code>--file-merged-requests</code> max I/O request to merge [0]</li>
<li><code>--file-rw-ratio</code> reads/writes ratio for combined test [1.5]</li>
</ul>
<p>As an example, for a system destined to run a MySQL server we could try something like this.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># a test simulating MySQL file activity
sysbench fileio run --threads=8 --file-extra-flags=direct --file-test-mode=rndrw --file-num=10 --file-block-size=1M --file-block-size=16K
</code></pre></div><p>After running our tests, we need only to remove the work files with <em>cleanup</em></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">-&gt; sysbench fileio cleanup --file-num=10

sysbench 1.0.15 (using system LuaJIT 2.0.5)

Removing test files...
</code></pre></div><h2 id="testing-mutexes">Testing mutexes</h2>
<p>This benchmark is intended to test the speed for mutex locks (mutex stands for &ldquo;mutual exclusion&rdquo;).
Which play an important role in multithreading. It simulates high concurrency, with threads acquiring and releasing locks all the time.</p>
<p>Sysbench creates an initial pool of <code>--mutex-num</code> mutexes, then it starts the threads, which iterate over an empty loop, every <code>--mutex-loops</code> the thread will
grab one random mutex from the pool, modify a global variable, and release it. Each event will acquire and release the mutexes until the <code>--mutex-locks</code> value is reached.</p>
<p>Here <code>--time</code> or <code>--events</code> are completely ignored. Sysbench always runs one event per thread.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">-&gt; sysbench mutex run --threads=10
sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 10
Initializing random number generator from current time


Initializing worker threads...

Threads started!


General statistics:
    total time:                          0.8845s
    total number of events:              10

Latency (ms):
         min:                                  802.84
         avg:                                  855.55
         max:                                  873.81
         95th percentile:                      877.61
         sum:                                 8555.51

Threads fairness:
    events (avg/stddev):           1.0000/0.00
    execution time (avg/stddev):   0.8556/0.02
</code></pre></div><h2 id="testing-threads">Testing threads</h2>
<p>Here we have a test for the CPU scheduler. It can simulate high concurrency conditions, where multiple threads
compete for mutexes.</p>
<p>Each thread will take <code>--thread-locks</code> mutexes and yield the CPU. This causes the thread to stop running and is placed on the run queue by the scheduler.
Once the thread is again scheduled to run, the mutexes are released.</p>
<p>A single event will perform these actions <code>--thread-yields</code> times, so the higher this number, the higher the concurrency placed on each mutex,
and the lower the number of events per second.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">-&gt; sysbench threads run --threads=4 --thread-yields=1000 --thread-locks=10
sysbench 1.0.15 (using system LuaJIT 2.0.5)

Running the test with following options:
Number of threads: 4
Initializing random number generator from current time


Initializing worker threads...

Threads started!


General statistics:
    total time:                          10.0005s
    total number of events:              50754

Latency (ms):
         min:                                    0.50
         avg:                                    0.79
         max:                                   14.37
         95th percentile:                        0.81
         sum:                                39980.48

Threads fairness:
    events (avg/stddev):           12688.5000/54.38
    execution time (avg/stddev):   9.9951/0.00
</code></pre></div><h2 id="related-links">Related links</h2>
<ul>
<li>sysbench's github: <a href="https://github.com/akopytov/sysbench">https://github.com/akopytov/sysbench</a></li>
</ul>
<h2 id="what-s-next">What's next?</h2>
<p>Whew, that was a longer post than I intended and to think I only covered a part of it all.</p>
<p>There is still more to say about sysbench, check the <a href="../sysbench-guide-2">second part</a> where I deal with databases, so the fun is just starting.</p>
<p>So long.</p>
<p>Tomas</p>

        
          <div class="blog-tags">
            
              <a href="https://tomfern.com/tags/linux/">linux</a>&nbsp;
            
              <a href="https://tomfern.com/tags/unix/">unix</a>&nbsp;
            
              <a href="https://tomfern.com/tags/guides/">guides</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ftomfern.com%2fpost%2fsysbench-guide-1%2f&amp;text=Benchmarking%20with%20sysbench&amp;via=TomFernBlog" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftomfern.com%2fpost%2fsysbench-guide-1%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2ftomfern.com%2fpost%2fsysbench-guide-1%2f&amp;title=Benchmarking%20with%20sysbench" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ftomfern.com%2fpost%2fsysbench-guide-1%2f&amp;title=Benchmarking%20with%20sysbench" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2ftomfern.com%2fpost%2fsysbench-guide-1%2f&amp;title=Benchmarking%20with%20sysbench" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ftomfern.com%2fpost%2fsysbench-guide-1%2f&amp;description=Benchmarking%20with%20sysbench" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/post/docker-perf-tips/">Making the most out of Docker</a></li>
                
                    <li><a href="/post/sysbench-guide-2/">Sysbench for databases</a></li>
                
                    <li><a href="/post/mysqlslap-guide-2/">MySQLSlap (part 2)</a></li>
                
                    <li><a href="/post/mysqlslap-guide-1/">MySQLSlap (part 1)</a></li>
                
                    <li><a href="/post/sar-guide/">System monitoring with sar</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://tomfern.com/post/mysqlslap-guide-2/" data-toggle="tooltip" data-placement="top" title="MySQLSlap (part 2)">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://tomfern.com/post/sysbench-guide-2/" data-toggle="tooltip" data-placement="top" title="Sysbench for databases">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:blog@tomfern.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/TomFernBlog" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            
            <a href="https://tomfern.com/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Tom
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2019
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://tomfern.com">tomfern.com</a>
          

    
    
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0"
    src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" />
</a>

        </p>
        
        <p class="credits theme-by text-muted"> O caos é uma ordem por descifrar</p>
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.61.0</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tomfern.com/js/main.js"></script>
<script src="https://tomfern.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://tomfern.com/js/load-photoswipe.js"></script>








    
  </body>
</html>

