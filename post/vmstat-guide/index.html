<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>A guide to vmstat and friends - tomfern.com</title>
  <meta property="og:title" content="A guide to vmstat and friends" />
  <meta name="twitter:title" content="A guide to vmstat and friends" />
  <meta name="description" content="A getting started guide for vmstat, iostat, mpstat and pidstat.">
  <meta property="og:description" content="A getting started guide for vmstat, iostat, mpstat and pidstat.">
  <meta name="twitter:description" content="A getting started guide for vmstat, iostat, mpstat and pidstat.">
  <meta name="author" content="Tom"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "tomfern.com",
    
    "url": "https:\/\/tomfern.com"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/tomfern.com"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/tomfern.com",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/tomfern.com\/post\/vmstat-guide\/",
          "name": "A guide to vmstat and friends"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Tom"
  },
  "headline": "A guide to vmstat and friends",
  "description" : "A getting started guide for vmstat, iostat, mpstat and pidstat.\n",
  "inLanguage" : "en",
  "wordCount":  2220 ,
  "datePublished" : "2019-01-06T21:12:00",
  "dateModified" : "2019-01-06T21:12:00",
  "image" : "https:\/\/tomfern.com",
  "keywords" : [ "guides, monitoring, linux, unix" ],
  "mainEntityOfPage" : "https:\/\/tomfern.com\/post\/vmstat-guide\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/tomfern.com",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/tomfern.com",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="A guide to vmstat and friends" />
<meta property="og:description" content="A getting started guide for vmstat, iostat, mpstat and pidstat.">
<meta property="og:url" content="https://tomfern.com/post/vmstat-guide/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="tomfern.com" />
  <meta name="twitter:title" content="A guide to vmstat and friends" />
  <meta name="twitter:description" content="A getting started guide for vmstat, iostat, mpstat and pidstat.">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@TomFernBlog" />
  <meta name="twitter:creator" content="@TomFernBlog" />
  <link href='https://tomfern.com/favicon/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@TomFernBlog" />
  <meta name="twitter:creator" content="@TomFernBlog" />
  <meta property="og:url" content="https://tomfern.com/post/vmstat-guide/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="tomfern.com" />

  <meta name="generator" content="Hugo 0.61.0" />
  <link rel="alternate" href="https://tomfern.com/index.xml" type="application/rss+xml" title="tomfern.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://tomfern.com/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://tomfern.com/css/highlight.min.css" /><link rel="stylesheet" href="https://tomfern.com/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<style>
 

div.alert {
  border-radius: 10px;
  margin-bottom: 1rem;
}

div.alert p {
  position: relative;
  display: block;
  font-size: 1rem;
  margin-left: 2rem;
  margin-top: 0;
  margin-bottom: 0;
}

div.alert p:first-child::before {
  position: absolute;
  top: -0.5rem;
  left: -2rem;
  font-family: 'FontAwesome';
  font-size: 1.5rem;
  color: #fff;
  content: '\f05a';
  width: 1.5rem;
  text-align: center;
}

div.alert-warning p:first-child::before {
  content: '\f071';
}

div.alert a {
  color: rgba(255,255,255,0.9);
  text-decoration: none;
  border-bottom: solid 1px #e4e4e4;
  transition: color 0.2s ease-in-out, border-color 0.2s ease-in-out;
}

div.alert a:hover {
  border-bottom-color: transparent;
  color: rgba(255,255,255,0.5) !important;
}

.alert-note {
  color: #fff;
  background-color: #03A9F4;  
  border-color: #bce8f1;
}

.alert-warning {
  color: #fff;
  background-color: #f44336;  
  border-color: #ebccd1;
}

.toc {
    background-color: #F5F5F5;
}

.heading {
    font-weight: 800;
}

.tip-box
{
     background-color: #f0f7fb;
     background-repeat: no-repeat;
     border-left: solid 4px #3498db;
     overflow: hidden;
     padding: 1rem;
}


</style>



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://tomfern.com">tomfern.com</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>A guide to vmstat and friends</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on January 6, 2019
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;11&nbsp;minutes
  
  
  
    &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Tom
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>A getting started guide for vmstat, iostat, mpstat and pidstat.</p>
<hr>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><a href="#vmstat">vmstat</a></li>
<li><a href="#iostat">iostat</a></li>
<li><a href="#mpstat">mpstat</a></li>
<li><a href="#pidstat">pidstat</a></li>
<li><a href="#putting-it-all-together">Putting it all together</a></li>
<li><a href="#related-links">Related links</a></li>
<li><a href="#what-s-next">What's next?</a></li>
</ul>
<!-- raw HTML omitted -->
<h2 id="vmstat">vmstat</h2>
<p>Once I figured out how vmstat works, I found that I almost could no longer live without it, it's that good.
Fortunately it's available everywhere, so I don't. There are many versions around, both for
Linux and Unix.</p>
<p>vmstat does a little bit of everything: memory, processes, I/O, swap, disks, CPU.</p>
<p>The basic syntax is:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">vmstat [options] &lt;interval&gt; &lt;count&gt;
</code></pre></div><p>vmstat prints a new update every <em>interval</em> seconds, stopping after <em>count</em> lines.
If no count is supplied, vmstat continues until killed. If there isn't any <em>interval</em>, only 1 line is printed.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># 1 update per second, 5 updates
-&gt; vmstat 1 5
procs   -----------memory----------   --swap-    ---io--- -system-- ------cpu-----
 r  b   swpd    free   buff  cache    si   so    bi    bo   in   cs us sy id wa st
 4  0      0 4098084 375068 3462944    0    0    34    25  340  320  8  3 89  0  0
 1  0      0 4098184 375068 3463264    0    0     0     0 1263 3198  4  3 93  0  0
 0  0      0 4098436 375068 3462924    0    0     0     0 1141 2999  3  2 95  0  0
 0  0      0 4097736 375076 3462916    0    0     0     0 2166 4414  5  4 92  0  0
 0  0      0 4096476 375076 3462916    0    0     0     0 1103 3130  3  3 94  0  0
</code></pre></div><p>The values in the very first line are averages since boot, thus it usually stands out as different than the rest.</p>
<p>All values, with the exception of memory and processes, are average <em>rates</em> from the previous update.
Memory and processes (the first 6 columns) are always instantaneous values.
Memory is shown in KBs but <code>-S</code> changes units, e.g. <code>-S M</code> for MBs.</p>
<p>If your version of vmstat supports <code>-w</code>, use it,  makes the table wider and easier to read.</p>
<p>So what does each column mean?</p>
<table>
<thead>
<tr>
<th>column</th>
<th>meaning</th>
<th>unit</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>number of processes running</td>
<td>-</td>
</tr>
<tr>
<td>b</td>
<td>number of processes sleeping</td>
<td>-</td>
</tr>
<tr>
<td>spwd</td>
<td>swap memory used</td>
<td>K</td>
</tr>
<tr>
<td>free</td>
<td>amount of idle memory</td>
<td>K</td>
</tr>
<tr>
<td>buff</td>
<td>memory used for buffers</td>
<td>K</td>
</tr>
<tr>
<td>cache</td>
<td>memory used for cache</td>
<td>K</td>
</tr>
<tr>
<td>si</td>
<td>swaps per second from disk to memory</td>
<td>1/s</td>
</tr>
<tr>
<td>so</td>
<td>swaps per second from memory to disk</td>
<td>1/s</td>
</tr>
<tr>
<td>bi</td>
<td>blocks per second received from block device</td>
<td>blocks/s</td>
</tr>
<tr>
<td>bo</td>
<td>blocks per second sent to block device</td>
<td>blocks/s</td>
</tr>
<tr>
<td>in</td>
<td>interrupts per second</td>
<td>1/s</td>
</tr>
<tr>
<td>cs</td>
<td>context switches per second</td>
<td>1/s</td>
</tr>
<tr>
<td>us</td>
<td>CPU user time</td>
<td>% of total</td>
</tr>
<tr>
<td>sy</td>
<td>CPU system time</td>
<td>% of total</td>
</tr>
<tr>
<td>id</td>
<td>CPU idle time</td>
<td>% of total</td>
</tr>
<tr>
<td>st</td>
<td>CPU time stolen from Virtual Machine</td>
<td>% of total</td>
</tr>
</tbody>
</table>
<p>A few guidelines to read the values:</p>
<ul>
<li>check first <em>si</em> and <em>so</em> for swapping activity, this is <em>the</em> performance killer</li>
<li>check that memory allocation makes sense for the workload</li>
<li>consistent high <em>us</em> indicate possible CPU bound load</li>
<li>consistent high <em>wa</em> indicate possible I/O bound load</li>
<li>if this is a VM and <em>st</em> (steal) is consistently high for long, the host system could be overloaded or the VM under-provisioned</li>
</ul>
<p><code>-d</code> gets us per-device I/O counters since boot. With <code>-p &lt;PART&gt;</code> we get the same for an specific parition.</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">-&gt; vmstat -d 1
disk- ------------reads------------ ------------writes----------- -----IO------
       total merged sectors      ms  total merged sectors      ms    cur    sec
sda   154968   4762 5471678   52614 123981  67290 4139296   68873      0     45
sda   154968   4762 5471678   52614 123985  67305 4139440   68876      0     45
sda   187412   5295 5735630   57902 126252  67704 5888256   80177      0     51
...
</code></pre></div><p>Columns are read like this:</p>
<table>
<thead>
<tr>
<th>column</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>total</td>
<td>total number of reads / writes</td>
</tr>
<tr>
<td>merged</td>
<td>merged requests (N requests into one I/O)</td>
</tr>
<tr>
<td>sectors</td>
<td>number of sectors read / written</td>
</tr>
<tr>
<td>ms</td>
<td>milliseconds spent reading / writing</td>
</tr>
<tr>
<td>cur</td>
<td>number of I/O operations running</td>
</tr>
<tr>
<td>s</td>
<td>seconds spent for I/O</td>
</tr>
</tbody>
</table>
<p>We can also access a detailed cache utilization report with <code>-m</code>, but it may require root permissions to work.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt; vmstat -m
Cache                            Num  Total   Size  Pages
ecryptfs_inode_cache            1544   1564    960     17
ecryptfs_file_cache              256   1024     16    256
ecryptfs_auth_tok_list_item       19     76    832     19
nf_conntrack_expect                0      0    216     18
nf_conntrack                     101    200    320     25
fuse_request                      80     80    400     20
fuse_inode                        42     76    832     19
ext4_groupinfo_4k               1716   1736    144     28
ext4_inode_cache              325004 327150   1080     30
ext4_allocation_context          128    128    128     32
ext4_io_end                      256    320     64     64
ext4_extent_status            156920 156978     40    102
mbcache                          294    438     56     73
...
</code></pre></div><p>And the columns are:</p>
<table>
<thead>
<tr>
<th>column</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>cache</td>
<td>the cache name</td>
</tr>
<tr>
<td>num</td>
<td>active object count</td>
</tr>
<tr>
<td>total</td>
<td>total object count</td>
</tr>
<tr>
<td>size</td>
<td>size per object</td>
</tr>
<tr>
<td>pages</td>
<td>pages with one or more active object</td>
</tr>
</tbody>
</table>
<p>vmstat also has these one-shot views:</p>
<ul>
<li><code>-s</code> system statistics</li>
<li><code>-D</code> all disks summary</li>
<li><code>-f</code> forks</li>
</ul>
<h2 id="iostat">iostat</h2>
<p>iostat shows the combined CPU and disk I/O statistics. As with vmstat, it can work with <em>interval</em> and <em>count</em></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># one update per second
-&gt; iostat 1
Linux 4.19.8-arch1-1-ARCH (ix) 	12/24/2018 	_x86_64_	(4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          12.14    0.03    5.66    0.03    0.00   82.14

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               4.41        29.11        49.44    3409859    5790640

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           5.56    0.00    3.79    0.00    0.00   90.66

Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
sda               0.00         0.00         0.00          0          0
...
</code></pre></div><p>Again, the first report shows averages since boot (we can omit it with <code>-y</code>). While the following shows rates since the previous interval.</p>
<p>We can choose to only see cpu with <code>-c</code> or disk with <code>-d</code>. Also <code>-x</code> shows extended I/O statistics and <code>-m</code> changes units to MB.
<code>-h</code> changes into an easier to read (for humans) format.</p>
<h2 id="mpstat">mpstat</h2>
<p>mpstat shows (more) detailed CPU statistics. We get vmstat's counters plus some. Same deal with the
<em>interval</em> and <em>count</em></p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># 1 update per second
-&gt; mpstat 1
Linux 4.19.8-arch1-1-ARCH (ix) 	12/24/2018 	_x86_64_	(4 CPU)

06:48:41 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
06:48:42 PM  all    7.85    0.00    3.04    0.00    0.25    0.51    0.00    0.00    0.00   88.35
06:48:43 PM  all   10.08    0.00    4.79    0.00    1.01    0.00    0.00    0.00    0.00   84.13
06:48:44 PM  all    7.25    0.00    5.25    0.00    0.75    0.50    0.00    0.00    0.00   86.25
06:48:45 PM  all    9.07    0.00    3.78    0.25    1.01    0.50    0.00    0.00    0.00   85.39
</code></pre></div><p>First line is, yet again, averages since boot.</p>
<p>We can choose to only show activity for some CPUs with <code>-P</code>, e.g. <code>-P 1,3</code></p>
<p>There are additional views: <code>-I ALL</code> shows all CPU interruptions, <code>-n</code> shows CPU statistics based on NUMA placement nodes
(use <code>-N</code> to indicate which nodes to report). There is even a JSON output with <code>-o JSON</code></p>
<p>mpstat shows general CPU utilization, to track an individual process there is <em>pidstat</em></p>
<h2 id="pidstat">pidstat</h2>
<p>This one has some similarities with <em>top</em>. Every <em>interval</em> pidstat prints what processes were running.
We can also track particular processes with <code>-p</code>. Threads are shown with <code>-t</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># track process CPU activity, thread view
-&gt; pidstat -t -p 25809 1
Linux 4.19.8-arch1-1-ARCH (ix) 	12/29/2018 	_x86_64_	(4 CPU)

11:00:58 PM   UID      TGID       TID    %usr %system  %guest   %wait    %CPU   CPU  Command
11:00:58 PM   980     25809         -    0.22    0.07    0.00    0.00    0.28     1  mysqld
11:00:58 PM   980         -     25809    0.00    0.00    0.00    0.00    0.00     1  |__mysqld
11:00:58 PM   980         -     25811    0.00    0.00    0.00    0.00    0.00     0  |__mysqld
11:00:58 PM   980         -     25812    0.00    0.00    0.00    0.00    0.00     3  |__mysqld
11:00:58 PM   980         -     25820    0.00    0.00    0.00    0.00    0.00     1  |__mysqld
11:00:58 PM   980         -     25834    0.02    0.01    0.00    0.01    0.02     3  |__mysqld
11:00:58 PM   980         -     25835    0.02    0.00    0.00    0.01    0.02     3  |__mysqld
11:00:58 PM   980         -     25836    0.01    0.00    0.00    0.01    0.02     2  |__mysqld
11:00:58 PM   980         -     25837    0.01    0.00    0.00    0.01    0.01     0  |__mysqld
</code></pre></div><p><code>-r</code> shows memory per process, which gives a quick way to check for memory leaks</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># track process memory activity
-&gt; pidstat -r -p 27766 1
Linux 4.19.8-arch1-1-ARCH (ix) 	12/30/2018 	_x86_64_	(4 CPU)

09:42:59 PM   UID       PID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command
09:43:00 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
09:43:01 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
09:43:02 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
09:43:03 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
Average:     1000     27766      0.00      0.00  689680   17128   0.15  mysqld
</code></pre></div><p>pidstat can start a program with <code>-e</code> and show its activity during the execution.</p>
<p>Besides CPU, pidstat can also show per-process I/O activity</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback"># per-process I/O
-&gt; pidstat -d 1 5
Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)

04:04:53 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
04:04:54 PM  1000     14423    276.00 197888.00      0.00       1  dd
04:04:55 PM  1000     14423      0.00 218880.00      0.00       0  dd
04:04:56 PM  1000     14423      0.00 224664.00      0.00       0  dd
04:04:57 PM  1000     14423      0.00 230428.00      0.00       0  dd
04:04:59 PM  1000     14423      0.00 192520.00      0.00       0  dd
Average:     1000     14423     46.00 207763.33      0.00       0  dd
</code></pre></div><p>If pidstat prints negative values, it means it doesn't have enough permissions to access the process.
Try switching to the user running the process (or as root, that should always).</p>
<p>pidstat supports all these views:</p>
<ul>
<li><code>-d</code>  I/O statistics</li>
<li><code>-u</code>  CPU statistics</li>
<li><code>-R</code>  process priority</li>
<li><code>-r</code>  memory utilization</li>
<li><code>-s</code>  stack utilization</li>
<li><code>-t</code>  thread statistics</li>
<li><code>-w</code>  task switching</li>
<li><code>-v</code>  file descriptor</li>
</ul>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>These programs complement each other. How would all work together?
Let's say we want to find why my machine is running slow.</p>
<p>The first thing we can check is vmstat:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">-&gt; vmstat 1
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0 12 773184 3782540 161528 3176304    0    0  1184 38944 2888 9877 20  5  1 74  0
 2  9 773184 3745748 161528 3213272    0    0  2660 36868 2876 7426 18  7  1 73  0
 0 11 773184 3630836 161540 3326616    0    0  2688 43052 2959 7064 23  5  1 70  0
 2 11 771648 2297092 161792 4873416    0    0  2672 40960 3034 7547 23  6  2 69  0
 1 11 771648 2255008 161796 4915000    0    0  2088 38912 2939 7370 24  6  2 67  0
 0 11 771648 2142616 161796 4992940    0    0  2148 38916 2976 8061 31  6  1 63  0
 1 10 771648 2100532 161804 5034252   20    0  1608 41012 3919 9665 34 11  1 54  0
 0 11 819776 149836 157540 6949188    0    0  1920 12292 2702 5527  6  4  0 90  0
</code></pre></div><p>What can you see? A consistent high number of sleeping (b), memory utilization going up, no swapping&hellip; that's good,
disks are being written.</p>
<p>Hmm, a consistently high CPU wait (wa).
There are indications of an I/O bottleneck, the CPUs are waiting for disks requests.</p>
<p>What does mpstat say?</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">mpstat 1
Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)

01:34:49 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
01:34:50 PM  all   24.54    0.00    4.22   68.87    1.06    1.06    0.00    0.00    0.00    0.26
01:34:51 PM  all   19.05    0.00    3.44   74.87    1.06    0.53    0.00    0.00    0.00    1.06
01:34:52 PM  all   19.37    0.00    3.14   74.61    0.79    1.05    0.00    0.00    0.00    1.05
01:34:54 PM  all   22.08    0.00    3.12   62.86    0.52    1.04    0.00    0.00    0.00   10.39
</code></pre></div><p>Again there it is, a high iowait. There is something funny going on with the disks.</p>
<p>Let's try iostat:</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">iostat -x 1 -y
Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           0.00    0.00    0.00    0.00    0.00    0.00

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
sda             54.00    0.00   2532.00      0.00     0.00     0.00   0.00   0.00    0.57    0.00   0.02    46.89     0.00   0.06   0.30
dm-0            54.00    0.00   2532.00      0.00     0.00     0.00   0.00   0.00    0.50    0.00   0.03    46.89     0.00   0.24   1.30
sdd              1.00  347.00      4.00  39512.00     0.00     0.00   0.00   0.00   53.00    5.42   0.99     4.00   113.87   2.86  99.40

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
          23.90    0.00    6.49   68.31    0.00    1.30

Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
sda             69.00    0.00   2636.00      0.00     2.00     0.00   2.82   0.00    0.58    0.00   0.06    38.20     0.00   0.29   2.00
dm-0            71.00    0.00   2636.00      0.00     0.00     0.00   0.00   0.00    1.03    0.00   0.07    37.13     0.00   0.32   2.30
sdd              0.00  340.00      0.00  38672.00     0.00     0.00   0.00   0.00    0.00    5.84   0.99     0.00   113.74   2.92  99.30

</code></pre></div><p>Quite a lot of writes on the <em>sdd</em> device. Even worse, the %util is reaching 100%, the device is saturated
(%util is only meaningful for spinning disks, RAID or SDD have different capacities)</p>
<p>So the problem seems to be related with sdd.</p>
<p>Can we check what processes are doing I/O?</p>
<div class="highlight"><pre class="chroma"><code class="language-fallback" data-lang="fallback">sudo pidstat -d 1
Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)

01:36:25 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
01:36:26 PM     0      2546      3.81      0.00      0.00     100  kworker/u8:3+flush-8:48
01:36:26 PM     0      2799      0.00     38.10      0.00      48  jbd2/sdd1-8
01:36:26 PM   980      3435   1474.29  36323.81      0.00       0  mysqld

01:36:26 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
01:36:27 PM     0      2546      0.00      0.00      0.00      99  kworker/u8:3+flush-8:48
01:36:27 PM   980      3435   2524.00  35096.00      0.00       0  mysqld
</code></pre></div><p>We find a mysql server, a kernel thread flushing data and jbd2 (filesystem journal).</p>
<p>Aha! we found what has been causing all that troublesome I/O. To continue investigating we would need to get into the database, but
this post is getting way too long already. If you are curious, the root cause was some bad queries that were creating temporary tables.</p>
<h2 id="related-links">Related links</h2>
<ul>
<li>manpages
<ul>
<li>vmstat: <a href="https://linux.die.net/man/8/vmstat">https://linux.die.net/man/8/vmstat</a></li>
<li>iostat: <a href="https://linux.die.net/man/1/iostat">https://linux.die.net/man/1/iostat</a></li>
<li>mpstat: <a href="https://linux.die.net/man/1/mpstat">https://linux.die.net/man/1/mpstat</a></li>
<li>pidstat: <a href="https://linux.die.net/man/1/pidstat">https://linux.die.net/man/1/pidstat</a></li>
</ul>
</li>
</ul>
<h2 id="what-s-next">What's next?</h2>
<p>How about some long term analysis? Something that can work unattended and do reports? Sounds nice?</p>
<p>Good, I guess <a href="../sar-guide">next article</a> will be about <strong>sar</strong>.</p>
<p>So long.</p>
<p>Tomas</p>

        
          <div class="blog-tags">
            
              <a href="https://tomfern.com/tags/guides/">guides</a>&nbsp;
            
              <a href="https://tomfern.com/tags/monitoring/">monitoring</a>&nbsp;
            
              <a href="https://tomfern.com/tags/linux/">linux</a>&nbsp;
            
              <a href="https://tomfern.com/tags/unix/">unix</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f&amp;text=A%20guide%20to%20vmstat%20and%20friends&amp;via=TomFernBlog" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//plus.google.com/share?url=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f" target="_blank" title="Share on Google Plus">
          <i class="fab fa-google-plus"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f&amp;title=A%20guide%20to%20vmstat%20and%20friends" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f&amp;title=A%20guide%20to%20vmstat%20and%20friends" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f&amp;title=A%20guide%20to%20vmstat%20and%20friends" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ftomfern.com%2fpost%2fvmstat-guide%2f&amp;description=A%20guide%20to%20vmstat%20and%20friends" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  
              </div>
            </section>
        

        
          
          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://tomfern.com/post/welcome/" data-toggle="tooltip" data-placement="top" title="Welcome, welcome &amp; welcome">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://tomfern.com/post/sar-guide/" data-toggle="tooltip" data-placement="top" title="System monitoring with sar">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:blog@tomfern.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/TomFernBlog" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            
            <a href="https://tomfern.com/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Tom
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2019
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://tomfern.com">tomfern.com</a>
          

    
    
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0"
    src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" />
</a>

        </p>
        
        <p class="credits theme-by text-muted"> O caos é uma ordem por descifrar</p>
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.61.0</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://tomfern.com/js/main.js"></script>
<script src="https://tomfern.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://tomfern.com/js/load-photoswipe.js"></script>








  </body>
</html>

