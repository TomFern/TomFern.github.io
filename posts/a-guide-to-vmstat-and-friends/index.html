<!doctype html><html lang=en-us><head><title>A guide to vmstat and friends | Chaos is order not yet deciphered</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A getting started guide for vmstat, iostat, mpstat and pidstat."><meta name=generator content="Hugo 0.98.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-169184519-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a class=button href=http://tomfern.com/index.xml>RSS</a></nav><main class=main><section id=single><h1 class=title>A guide to vmstat and friends</h1><div class=tip><time datetime="2019-01-06 21:12:00 -0300 -03">Jan 6, 2019</time>
<span class=split>¬∑</span>
<span>2209 words</span>
<span class=split>¬∑</span>
<span>11 minute read</span></div><div class=content><p><p class=markdown-image><img src=/images/linux.jpg alt></p>A getting started guide for vmstat, iostat, mpstat and pidstat.</p><h2 id=vmstat>vmstat <a href=#vmstat class=anchor>üîó</a></h2><p>Once I figured out how vmstat works, I found that I almost could no longer live without it, it&rsquo;s that good.
Fortunately it&rsquo;s available everywhere, so I don&rsquo;t. There are many versions around, both for
Linux and Unix.</p><p>vmstat does a little bit of everything: memory, processes, I/O, swap, disks, CPU.</p><p>The basic syntax is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>vmstat [options] &lt;interval&gt; &lt;count&gt;
</span></span></code></pre></div><p>vmstat prints a new update every <em>interval</em> seconds, stopping after <em>count</em> lines.
If no count is supplied, vmstat continues until killed. If there isn&rsquo;t any <em>interval</em>, only 1 line is printed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># 1 update per second, 5 updates
</span></span><span style=display:flex><span>-&gt; vmstat 1 5
</span></span><span style=display:flex><span>procs   -----------memory----------   --swap-    ---io--- -system-- ------cpu-----
</span></span><span style=display:flex><span> r  b   swpd    free   buff  cache    si   so    bi    bo   in   cs us sy id wa st
</span></span><span style=display:flex><span> 4  0      0 4098084 375068 3462944    0    0    34    25  340  320  8  3 89  0  0
</span></span><span style=display:flex><span> 1  0      0 4098184 375068 3463264    0    0     0     0 1263 3198  4  3 93  0  0
</span></span><span style=display:flex><span> 0  0      0 4098436 375068 3462924    0    0     0     0 1141 2999  3  2 95  0  0
</span></span><span style=display:flex><span> 0  0      0 4097736 375076 3462916    0    0     0     0 2166 4414  5  4 92  0  0
</span></span><span style=display:flex><span> 0  0      0 4096476 375076 3462916    0    0     0     0 1103 3130  3  3 94  0  0
</span></span></code></pre></div><p>The values in the very first line are averages since boot, thus it usually stands out as different than the rest.</p><p>All values, with the exception of memory and processes, are average <em>rates</em> from the previous update.
Memory and processes (the first 6 columns) are always instantaneous values.
Memory is shown in KBs but <code>-S</code> changes units, e.g. <code>-S M</code> for MBs.</p><p>If your version of vmstat supports <code>-w</code>, use it, makes the table wider and easier to read.</p><p>So what does each column mean?</p><table><thead><tr><th>column</th><th>meaning</th><th>unit</th></tr></thead><tbody><tr><td>r</td><td>number of processes running</td><td>-</td></tr><tr><td>b</td><td>number of processes sleeping</td><td>-</td></tr><tr><td>spwd</td><td>swap memory used</td><td>K</td></tr><tr><td>free</td><td>amount of idle memory</td><td>K</td></tr><tr><td>buff</td><td>memory used for buffers</td><td>K</td></tr><tr><td>cache</td><td>memory used for cache</td><td>K</td></tr><tr><td>si</td><td>swaps per second from disk to memory</td><td>1/s</td></tr><tr><td>so</td><td>swaps per second from memory to disk</td><td>1/s</td></tr><tr><td>bi</td><td>blocks per second received from block device</td><td>blocks/s</td></tr><tr><td>bo</td><td>blocks per second sent to block device</td><td>blocks/s</td></tr><tr><td>in</td><td>interrupts per second</td><td>1/s</td></tr><tr><td>cs</td><td>context switches per second</td><td>1/s</td></tr><tr><td>us</td><td>CPU user time</td><td>% of total</td></tr><tr><td>sy</td><td>CPU system time</td><td>% of total</td></tr><tr><td>id</td><td>CPU idle time</td><td>% of total</td></tr><tr><td>st</td><td>CPU time stolen from Virtual Machine</td><td>% of total</td></tr></tbody></table><p>A few guidelines to read the values:</p><ul><li>check first <em>si</em> and <em>so</em> for swapping activity, this is <em>the</em> performance killer</li><li>check that memory allocation makes sense for the workload</li><li>consistent high <em>us</em> indicate possible CPU bound load</li><li>consistent high <em>wa</em> indicate possible I/O bound load</li><li>if this is a VM and <em>st</em> (steal) is consistently high for long, the host system could be overloaded or the VM under-provisioned</li></ul><p><code>-d</code> gets us per-device I/O counters since boot. With <code>-p &lt;PART></code> we get the same for an specific parition.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>-&gt; vmstat -d 1
</span></span><span style=display:flex><span>disk- ------------reads------------ ------------writes----------- -----IO------
</span></span><span style=display:flex><span>       total merged sectors      ms  total merged sectors      ms    cur    sec
</span></span><span style=display:flex><span>sda   154968   4762 5471678   52614 123981  67290 4139296   68873      0     45
</span></span><span style=display:flex><span>sda   154968   4762 5471678   52614 123985  67305 4139440   68876      0     45
</span></span><span style=display:flex><span>sda   187412   5295 5735630   57902 126252  67704 5888256   80177      0     51
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Columns are read like this:</p><table><thead><tr><th>column</th><th>meaning</th></tr></thead><tbody><tr><td>total</td><td>total number of reads / writes</td></tr><tr><td>merged</td><td>merged requests (N requests into one I/O)</td></tr><tr><td>sectors</td><td>number of sectors read / written</td></tr><tr><td>ms</td><td>milliseconds spent reading / writing</td></tr><tr><td>cur</td><td>number of I/O operations running</td></tr><tr><td>s</td><td>seconds spent for I/O</td></tr></tbody></table><p>We can also access a detailed cache utilization report with <code>-m</code>, but it may require root permissions to work.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; vmstat -m
</span></span><span style=display:flex><span>Cache                            Num  Total   Size  Pages
</span></span><span style=display:flex><span>ecryptfs_inode_cache            1544   1564    960     17
</span></span><span style=display:flex><span>ecryptfs_file_cache              256   1024     16    256
</span></span><span style=display:flex><span>ecryptfs_auth_tok_list_item       19     76    832     19
</span></span><span style=display:flex><span>nf_conntrack_expect                0      0    216     18
</span></span><span style=display:flex><span>nf_conntrack                     101    200    320     25
</span></span><span style=display:flex><span>fuse_request                      80     80    400     20
</span></span><span style=display:flex><span>fuse_inode                        42     76    832     19
</span></span><span style=display:flex><span>ext4_groupinfo_4k               1716   1736    144     28
</span></span><span style=display:flex><span>ext4_inode_cache              325004 327150   1080     30
</span></span><span style=display:flex><span>ext4_allocation_context          128    128    128     32
</span></span><span style=display:flex><span>ext4_io_end                      256    320     64     64
</span></span><span style=display:flex><span>ext4_extent_status            156920 156978     40    102
</span></span><span style=display:flex><span>mbcache                          294    438     56     73
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>And the columns are:</p><table><thead><tr><th>column</th><th>meaning</th></tr></thead><tbody><tr><td>cache</td><td>the cache name</td></tr><tr><td>num</td><td>active object count</td></tr><tr><td>total</td><td>total object count</td></tr><tr><td>size</td><td>size per object</td></tr><tr><td>pages</td><td>pages with one or more active object</td></tr></tbody></table><p>vmstat also has these one-shot views:</p><ul><li><code>-s</code> system statistics</li><li><code>-D</code> all disks summary</li><li><code>-f</code> forks</li></ul><h2 id=iostat>iostat <a href=#iostat class=anchor>üîó</a></h2><p>iostat shows the combined CPU and disk I/O statistics. As with vmstat, it can work with <em>interval</em> and <em>count</em></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># one update per second
</span></span><span style=display:flex><span>-&gt; iostat 1
</span></span><span style=display:flex><span>Linux 4.19.8-arch1-1-ARCH (ix) 	12/24/2018 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>avg-cpu:  %user   %nice %system %iowait  %steal   %idle
</span></span><span style=display:flex><span>          12.14    0.03    5.66    0.03    0.00   82.14
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
</span></span><span style=display:flex><span>sda               4.41        29.11        49.44    3409859    5790640
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>avg-cpu:  %user   %nice %system %iowait  %steal   %idle
</span></span><span style=display:flex><span>           5.56    0.00    3.79    0.00    0.00   90.66
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device             tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
</span></span><span style=display:flex><span>sda               0.00         0.00         0.00          0          0
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>Again, the first report shows averages since boot (we can omit it with <code>-y</code>). While the following shows rates since the previous interval.</p><p>We can choose to only see cpu with <code>-c</code> or disk with <code>-d</code>. Also <code>-x</code> shows extended I/O statistics and <code>-m</code> changes units to MB.
<code>-h</code> changes into an easier to read (for humans) format.</p><h2 id=mpstat>mpstat <a href=#mpstat class=anchor>üîó</a></h2><p>mpstat shows (more) detailed CPU statistics. We get vmstat&rsquo;s counters plus some. Same deal with the
<em>interval</em> and <em>count</em></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># 1 update per second
</span></span><span style=display:flex><span>-&gt; mpstat 1
</span></span><span style=display:flex><span>Linux 4.19.8-arch1-1-ARCH (ix) 	12/24/2018 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>06:48:41 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span style=display:flex><span>06:48:42 PM  all    7.85    0.00    3.04    0.00    0.25    0.51    0.00    0.00    0.00   88.35
</span></span><span style=display:flex><span>06:48:43 PM  all   10.08    0.00    4.79    0.00    1.01    0.00    0.00    0.00    0.00   84.13
</span></span><span style=display:flex><span>06:48:44 PM  all    7.25    0.00    5.25    0.00    0.75    0.50    0.00    0.00    0.00   86.25
</span></span><span style=display:flex><span>06:48:45 PM  all    9.07    0.00    3.78    0.25    1.01    0.50    0.00    0.00    0.00   85.39
</span></span></code></pre></div><p>First line is, yet again, averages since boot.</p><p>We can choose to only show activity for some CPUs with <code>-P</code>, e.g. <code>-P 1,3</code></p><p>There are additional views: <code>-I ALL</code> shows all CPU interruptions, <code>-n</code> shows CPU statistics based on NUMA placement nodes
(use <code>-N</code> to indicate which nodes to report). There is even a JSON output with <code>-o JSON</code></p><p>mpstat shows general CPU utilization, to track an individual process there is <em>pidstat</em></p><h2 id=pidstat>pidstat <a href=#pidstat class=anchor>üîó</a></h2><p>This one has some similarities with <em>top</em>. Every <em>interval</em> pidstat prints what processes were running.
We can also track particular processes with <code>-p</code>. Threads are shown with <code>-t</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># track process CPU activity, thread view
</span></span><span style=display:flex><span>-&gt; pidstat -t -p 25809 1
</span></span><span style=display:flex><span>Linux 4.19.8-arch1-1-ARCH (ix) 	12/29/2018 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>11:00:58 PM   UID      TGID       TID    %usr %system  %guest   %wait    %CPU   CPU  Command
</span></span><span style=display:flex><span>11:00:58 PM   980     25809         -    0.22    0.07    0.00    0.00    0.28     1  mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25809    0.00    0.00    0.00    0.00    0.00     1  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25811    0.00    0.00    0.00    0.00    0.00     0  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25812    0.00    0.00    0.00    0.00    0.00     3  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25820    0.00    0.00    0.00    0.00    0.00     1  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25834    0.02    0.01    0.00    0.01    0.02     3  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25835    0.02    0.00    0.00    0.01    0.02     3  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25836    0.01    0.00    0.00    0.01    0.02     2  |__mysqld
</span></span><span style=display:flex><span>11:00:58 PM   980         -     25837    0.01    0.00    0.00    0.01    0.01     0  |__mysqld
</span></span></code></pre></div><p><code>-r</code> shows memory per process, which gives a quick way to check for memory leaks</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># track process memory activity
</span></span><span style=display:flex><span>-&gt; pidstat -r -p 27766 1
</span></span><span style=display:flex><span>Linux 4.19.8-arch1-1-ARCH (ix) 	12/30/2018 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>09:42:59 PM   UID       PID  minflt/s  majflt/s     VSZ     RSS   %MEM  Command
</span></span><span style=display:flex><span>09:43:00 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
</span></span><span style=display:flex><span>09:43:01 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
</span></span><span style=display:flex><span>09:43:02 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
</span></span><span style=display:flex><span>09:43:03 PM  1000     27766      0.00      0.00  689680   17128   0.15  mysqld
</span></span><span style=display:flex><span>Average:     1000     27766      0.00      0.00  689680   17128   0.15  mysqld
</span></span></code></pre></div><p>pidstat can start a program with <code>-e</code> and show its activity during the execution.</p><p>Besides CPU, pidstat can also show per-process I/O activity</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># per-process I/O
</span></span><span style=display:flex><span>-&gt; pidstat -d 1 5
</span></span><span style=display:flex><span>Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>04:04:53 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
</span></span><span style=display:flex><span>04:04:54 PM  1000     14423    276.00 197888.00      0.00       1  dd
</span></span><span style=display:flex><span>04:04:55 PM  1000     14423      0.00 218880.00      0.00       0  dd
</span></span><span style=display:flex><span>04:04:56 PM  1000     14423      0.00 224664.00      0.00       0  dd
</span></span><span style=display:flex><span>04:04:57 PM  1000     14423      0.00 230428.00      0.00       0  dd
</span></span><span style=display:flex><span>04:04:59 PM  1000     14423      0.00 192520.00      0.00       0  dd
</span></span><span style=display:flex><span>Average:     1000     14423     46.00 207763.33      0.00       0  dd
</span></span></code></pre></div><p>If pidstat prints negative values, it means it doesn&rsquo;t have enough permissions to access the process.
Try switching to the user running the process (or as root, that should always).</p><p>pidstat supports all these views:</p><ul><li><code>-d</code> I/O statistics</li><li><code>-u</code> CPU statistics</li><li><code>-R</code> process priority</li><li><code>-r</code> memory utilization</li><li><code>-s</code> stack utilization</li><li><code>-t</code> thread statistics</li><li><code>-w</code> task switching</li><li><code>-v</code> file descriptor</li></ul><h2 id=putting-it-all-together>Putting It All Together <a href=#putting-it-all-together class=anchor>üîó</a></h2><p>These programs complement each other. How would all work together?
Let&rsquo;s say we want to find why my machine is running slow.</p><p>The first thing we can check is vmstat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>-&gt; vmstat 1
</span></span><span style=display:flex><span>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
</span></span><span style=display:flex><span> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
</span></span><span style=display:flex><span> 0 12 773184 3782540 161528 3176304    0    0  1184 38944 2888 9877 20  5  1 74  0
</span></span><span style=display:flex><span> 2  9 773184 3745748 161528 3213272    0    0  2660 36868 2876 7426 18  7  1 73  0
</span></span><span style=display:flex><span> 0 11 773184 3630836 161540 3326616    0    0  2688 43052 2959 7064 23  5  1 70  0
</span></span><span style=display:flex><span> 2 11 771648 2297092 161792 4873416    0    0  2672 40960 3034 7547 23  6  2 69  0
</span></span><span style=display:flex><span> 1 11 771648 2255008 161796 4915000    0    0  2088 38912 2939 7370 24  6  2 67  0
</span></span><span style=display:flex><span> 0 11 771648 2142616 161796 4992940    0    0  2148 38916 2976 8061 31  6  1 63  0
</span></span><span style=display:flex><span> 1 10 771648 2100532 161804 5034252   20    0  1608 41012 3919 9665 34 11  1 54  0
</span></span><span style=display:flex><span> 0 11 819776 149836 157540 6949188    0    0  1920 12292 2702 5527  6  4  0 90  0
</span></span></code></pre></div><p>What can you see? A consistent high number of sleeping (b), memory utilization going up, no swapping&mldr; that&rsquo;s good,
disks are being written.</p><p>Hmm, a consistently high CPU wait (wa).
There are indications of an I/O bottleneck, the CPUs are waiting for disks requests.</p><p>What does mpstat say?</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>mpstat 1
</span></span><span style=display:flex><span>Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>01:34:49 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
</span></span><span style=display:flex><span>01:34:50 PM  all   24.54    0.00    4.22   68.87    1.06    1.06    0.00    0.00    0.00    0.26
</span></span><span style=display:flex><span>01:34:51 PM  all   19.05    0.00    3.44   74.87    1.06    0.53    0.00    0.00    0.00    1.06
</span></span><span style=display:flex><span>01:34:52 PM  all   19.37    0.00    3.14   74.61    0.79    1.05    0.00    0.00    0.00    1.05
</span></span><span style=display:flex><span>01:34:54 PM  all   22.08    0.00    3.12   62.86    0.52    1.04    0.00    0.00    0.00   10.39
</span></span></code></pre></div><p>Again there it is, a high iowait. There is something funny going on with the disks.</p><p>Let&rsquo;s try iostat:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>iostat -x 1 -y
</span></span><span style=display:flex><span>Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>avg-cpu:  %user   %nice %system %iowait  %steal   %idle
</span></span><span style=display:flex><span>           0.00    0.00    0.00    0.00    0.00    0.00
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
</span></span><span style=display:flex><span>sda             54.00    0.00   2532.00      0.00     0.00     0.00   0.00   0.00    0.57    0.00   0.02    46.89     0.00   0.06   0.30
</span></span><span style=display:flex><span>dm-0            54.00    0.00   2532.00      0.00     0.00     0.00   0.00   0.00    0.50    0.00   0.03    46.89     0.00   0.24   1.30
</span></span><span style=display:flex><span>sdd              1.00  347.00      4.00  39512.00     0.00     0.00   0.00   0.00   53.00    5.42   0.99     4.00   113.87   2.86  99.40
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>avg-cpu:  %user   %nice %system %iowait  %steal   %idle
</span></span><span style=display:flex><span>          23.90    0.00    6.49   68.31    0.00    1.30
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util
</span></span><span style=display:flex><span>sda             69.00    0.00   2636.00      0.00     2.00     0.00   2.82   0.00    0.58    0.00   0.06    38.20     0.00   0.29   2.00
</span></span><span style=display:flex><span>dm-0            71.00    0.00   2636.00      0.00     0.00     0.00   0.00   0.00    1.03    0.00   0.07    37.13     0.00   0.32   2.30
</span></span><span style=display:flex><span>sdd              0.00  340.00      0.00  38672.00     0.00     0.00   0.00   0.00    0.00    5.84   0.99     0.00   113.74   2.92  99.30
</span></span></code></pre></div><p>Quite a lot of writes on the <em>sdd</em> device. Even worse, the %util is reaching 100%, the device is saturated
(%util is only meaningful for spinning disks, RAID or SDD have different capacities)</p><p>So the problem seems to be related with sdd.</p><p>Can we check what processes are doing I/O?</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo pidstat -d 1
</span></span><span style=display:flex><span>Linux 4.20.0-arch1-1-ARCH (ix) 	01/06/2019 	_x86_64_	(4 CPU)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>01:36:25 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
</span></span><span style=display:flex><span>01:36:26 PM     0      2546      3.81      0.00      0.00     100  kworker/u8:3+flush-8:48
</span></span><span style=display:flex><span>01:36:26 PM     0      2799      0.00     38.10      0.00      48  jbd2/sdd1-8
</span></span><span style=display:flex><span>01:36:26 PM   980      3435   1474.29  36323.81      0.00       0  mysqld
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>01:36:26 PM   UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command
</span></span><span style=display:flex><span>01:36:27 PM     0      2546      0.00      0.00      0.00      99  kworker/u8:3+flush-8:48
</span></span><span style=display:flex><span>01:36:27 PM   980      3435   2524.00  35096.00      0.00       0  mysqld
</span></span></code></pre></div><p>We find a mysql server, a kernel thread flushing data and jbd2 (filesystem journal).</p><p>Aha! we found what has been causing all that troublesome I/O. To continue investigating we would need to get into the database, but
this post is getting way too long already. If you are curious, the root cause was some bad queries that were creating temporary tables.</p><h2 id=related-links>Related Links <a href=#related-links class=anchor>üîó</a></h2><ul><li>manpages<ul><li>vmstat: <a href=https://linux.die.net/man/8/vmstat target=_blank rel=noopener>https://linux.die.net/man/8/vmstat</a></li><li>iostat: <a href=https://linux.die.net/man/1/iostat target=_blank rel=noopener>https://linux.die.net/man/1/iostat</a></li><li>mpstat: <a href=https://linux.die.net/man/1/mpstat target=_blank rel=noopener>https://linux.die.net/man/1/mpstat</a></li><li>pidstat: <a href=https://linux.die.net/man/1/pidstat target=_blank rel=noopener>https://linux.die.net/man/1/pidstat</a></li></ul></li></ul><h2 id=whats-next>What&rsquo;s Next? <a href=#whats-next class=anchor>üîó</a></h2><p>How about some long term analysis? Something that can work unattended and do reports? Sounds nice?</p><p>Good, I guess <a href=./sar-guide>next article</a> will be about <strong>sar</strong>.</p><p>So long.</p><p>Tomas</p></div><div class=tags><a href=http://tomfern.com/tags/guides>guides</a>
<a href=http://tomfern.com/tags/monitoring>monitoring</a>
<a href=http://tomfern.com/tags/linux>linux</a>
<a href=http://tomfern.com/tags/unix>unix</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/TomFern rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a><a class=symbol href=https://github.com/TomFernBlog rel=me target=_blank><svg fill="#bbb" width="28" height="28" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="438.536" height="438.536" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536"><g><path d="M414.41 24.123C398.333 8.042 378.963.0 356.315.0H82.228C59.58.0 40.21 8.042 24.126 24.123 8.045 40.207.003 59.576.003 82.225v274.084c0 22.647 8.042 42.018 24.123 58.102 16.084 16.084 35.454 24.126 58.102 24.126h274.084c22.648.0 42.018-8.042 58.095-24.126 16.084-16.084 24.126-35.454 24.126-58.102V82.225C438.532 59.576 430.49 40.204 414.41 24.123zM335.471 168.735c.191 1.713.288 4.278.288 7.71.0 15.989-2.334 32.025-6.995 48.104-4.661 16.087-11.8 31.504-21.416 46.254-9.606 14.749-21.074 27.791-34.396 39.115-13.325 11.32-29.311 20.365-47.968 27.117-18.648 6.762-38.637 10.143-59.953 10.143-33.116.0-63.76-8.952-91.931-26.836 4.568.568 9.329.855 14.275.855 27.6.0 52.439-8.565 74.519-25.7-12.941-.185-24.506-4.179-34.688-11.991-10.185-7.803-17.273-17.699-21.271-29.691 4.947.76 8.658 1.137 11.132 1.137 4.187.0 9.042-.76 14.56-2.279-13.894-2.669-25.598-9.562-35.115-20.697-9.519-11.136-14.277-23.84-14.277-38.114v-.571c10.085 4.755 19.602 7.229 28.549 7.422-17.321-11.613-25.981-28.265-25.981-49.963.0-10.66 2.758-20.747 8.278-30.264 15.035 18.464 33.311 33.213 54.816 44.252 21.507 11.038 44.54 17.227 69.092 18.558-.95-3.616-1.427-8.186-1.427-13.704.0-16.562 5.853-30.692 17.56-42.399 11.703-11.706 25.837-17.561 42.394-17.561 17.515.0 32.079 6.283 43.688 18.846 13.134-2.474 25.892-7.33 38.26-14.56-4.757 14.652-13.613 25.788-26.55 33.402 12.368-1.716 23.88-4.95 34.537-9.708C357.458 149.793 347.462 160.166 335.471 168.735z"/></g></svg></a></div><div class=copyright>¬© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span>Tommy ‚Äî Technical Writer at Semaphore</div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>